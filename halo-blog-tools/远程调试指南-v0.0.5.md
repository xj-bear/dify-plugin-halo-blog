# Halo Blog Tools v0.0.5 远程调试指南

## 当前状态

✅ **插件代码已修复完成**
- 修复了文章创建编辑器兼容性问题
- 修复了文章更新实际未更新的问题
- 插件包已生成：`halo-blog-tools-v0.0.5.difypkg`

⚠️ **需要获取有效的远程调试Key**
- 当前Key已过期或无效
- 需要从cloud.dify.ai获取新的调试Key

## 远程调试步骤

### 第1步：获取调试Key

1. **访问Dify插件管理页面**
   ```
   https://cloud.dify.ai/plugins
   ```

2. **获取远程调试信息**
   - 在插件管理页面找到"远程调试"或"Plugin Debug"选项
   - 复制远程服务器地址（通常是 `debug.dify.ai:5003`）
   - 复制调试Key（格式类似：`xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx`）

### 第2步：更新.env配置

将获取的信息更新到 `.env` 文件中：

```bash
# 远程调试配置
INSTALL_METHOD=remote
REMOTE_INSTALL_URL=debug.dify.ai:5003
REMOTE_INSTALL_KEY=你的新调试Key
```

### 第3步：启动远程调试

在 `halo-blog-tools` 目录下运行：

```bash
python -m main
```

### 第4步：验证连接

如果连接成功，你会看到类似的日志：

```
2025-07-01 14:55:47,654 - __main__ - INFO - Starting Halo Blog Tools plugin...
2025-07-01 14:55:47,655 - __main__ - INFO - Plugin starting with install method: remote
2025-07-01 14:55:48,389 - dify_plugin.core.server.tcp.request_reader - INFO - Connected to debug.dify.ai:5003
2025-07-01 14:55:48,397 - dify_plugin.plugin - INFO - Installed tool: halo-blog-tools
2025-07-01 14:55:48,398 - __main__ - INFO - Halo Blog Tools plugin initialized successfully
```

**如果看到错误**：
```
ERROR - An error occurred while parsing the data: b'handshake failed, invalid key'
```
说明调试Key无效，需要重新获取。

## 测试步骤

### 第5步：在cloud.dify.ai中测试

1. **访问Dify应用**
   ```
   https://cloud.dify.ai
   ```

2. **创建或打开应用**
   - 创建新的Agent应用
   - 或打开现有应用

3. **添加Halo Blog Tools**
   - 在工具列表中找到"Halo Blog Tools"
   - 添加到应用中

4. **配置连接信息**
   ```
   Base URL: https://blog.u2u.fun  (你的Halo站点)
   Access Token: pat_xxxxxxxxxx    (你的Halo访问令牌)
   ```

### 第6步：功能测试

**测试文章创建**：
```
请帮我创建一篇文章：
标题：测试文章创建功能 v0.0.5
内容：# 测试内容

这是一篇测试文章，用于验证v0.0.5版本的修复效果。

## 测试项目
- 编辑器兼容性
- 内容设置
- 快照机制

标签：测试,v0.0.5
分类：测试分类
```

**测试文章更新**：
```
请帮我更新文章ID为 [刚创建的文章ID]：
标题：更新测试文章 v0.0.5
内容：# 更新后的内容

这是更新后的内容，验证更新功能是否正常工作。

更新时间：[当前时间]
```

## 预期结果

### 文章创建测试
- ✅ 文章创建成功
- ✅ 返回文章ID和编辑器链接
- ✅ 可以在Halo编辑器中正常打开和编辑
- ✅ Markdown格式正确显示

### 文章更新测试
- ✅ 文章更新成功
- ✅ 内容实际发生变化
- ✅ 编辑器中可以看到更新后的内容
- ✅ 保持编辑器兼容性

## 日志分析

### 成功日志示例
```
INFO - Starting Halo Blog Tools plugin...
INFO - Connected to debug.dify.ai:5003
INFO - Installed tool: halo-blog-tools
INFO - Halo Blog Tools plugin initialized successfully
```

### 工具调用日志
当你在Dify中使用工具时，会看到类似日志：
```
INFO - Tool invoked: halo-post-create
INFO - Creating post with title: 测试文章创建功能 v0.0.5
INFO - Post created successfully: post-xxxxxxxxx
INFO - Editor compatibility annotations set
```

### 错误日志分析
- `handshake failed, invalid key` - 调试Key无效
- `Connection is closed` - 网络连接问题
- `认证失败` - Halo访问令牌无效
- `权限不足` - Token权限不够

## 故障排除

### 1. 调试Key问题
**症状**：`handshake failed, invalid key`
**解决**：
1. 重新访问 https://cloud.dify.ai/plugins
2. 获取新的调试Key
3. 更新.env文件
4. 重启调试进程

### 2. 网络连接问题
**症状**：`Connection is closed`
**解决**：
1. 检查网络连接
2. 确认防火墙设置
3. 尝试重新连接

### 3. Halo连接问题
**症状**：`认证失败` 或 `权限不足`
**解决**：
1. 检查Halo站点地址是否正确
2. 验证访问令牌是否有效
3. 确认令牌具有文章管理权限

## 修复验证清单

完成远程调试后，请验证以下修复效果：

### 文章创建修复验证
- [ ] 文章创建成功
- [ ] 包含编辑器兼容性注解
- [ ] 可在编辑器中正常打开
- [ ] Markdown格式正确显示
- [ ] 支持所有编辑器功能

### 文章更新修复验证
- [ ] 文章更新成功
- [ ] 内容实际发生变化
- [ ] 快照正确创建和关联
- [ ] Console Content API正常工作
- [ ] 编辑器中显示更新后内容

### 整体功能验证
- [ ] 所有工具正常加载
- [ ] 错误处理正确
- [ ] 状态报告清晰
- [ ] 日志信息完整

## 下一步

完成远程调试和测试后：

1. **收集测试结果**
   - 记录成功的功能
   - 记录任何问题或错误
   - 保存重要的日志信息

2. **生成测试报告**
   - 总结修复效果
   - 记录性能表现
   - 提供改进建议

3. **准备发布**
   - 确认所有功能正常
   - 更新文档
   - 准备发布说明

---

**当前版本**: v0.0.5  
**修复状态**: ✅ 代码修复完成，等待远程调试验证  
**下一步**: 获取有效调试Key并进行远程测试
