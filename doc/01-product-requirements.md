# 产品需求文档 (PRD)

## 1. 产品概述

### 1.1 产品背景
Dify Halo 插件是一个为 Dify 平台设计的第三方工具插件，旨在提供完整的 Halo 博客系统集成能力。通过此插件，用户可以在 Dify 的工作流中直接管理 Halo 博客的文章和瞬间内容。

### 1.2 产品定位
- **目标用户**: 使用 Halo 博客系统的内容创作者、博客管理员
- **核心价值**: 简化内容发布流程，提升内容管理效率
- **应用场景**: AI 辅助内容创作、自动化内容发布、批量内容管理

### 1.3 产品目标
- 提供完整的 Halo 博客集成功能
- 支持文章的全生命周期管理
- 实现 Moment 瞬间内容的创建和管理
- 确保安全可靠的认证机制

## 2. 功能需求

### 2.1 核心功能列表

#### 2.1.1 认证授权功能
- **功能描述**: 通过 Halo 个人访问令牌实现安全认证
- **输入参数**: 
  - Halo 站点 URL
  - 个人访问令牌 (Personal Access Token)
- **验证要求**: 
  - 令牌需要具备 "Post Manage" 权限
  - 支持 Halo 2.21+ 版本
- **安全考虑**: 令牌加密存储，支持令牌刷新

#### 2.1.2 文章获取功能
- **功能名称**: `get_posts`
- **功能描述**: 获取 Halo 博客的文章列表
- **输入参数**:
  - `page`: 页码 (可选，默认 1)
  - `size`: 每页数量 (可选，默认 10)
  - `keyword`: 关键词搜索 (可选)
  - `category`: 分类筛选 (可选)
  - `tag`: 标签筛选 (可选)
  - `status`: 文章状态 (可选: PUBLISHED, DRAFT, RECYCLE)
  - `sort`: 排序方式 (可选，如: createTime, publishTime, updateTime)
  - `order`: 排序顺序 (可选，如: desc, asc)
- **输出数据**:
  - 文章列表 (ID, 标题, 摘要, 发布状态, 创建时间)
  - 分页信息 (总数、页码、是否有更多)

#### 2.1.3 文章详情获取功能
- **功能名称**: `get_post_detail`
- **功能描述**: 根据文章 ID 获取完整的文章信息
- **输入参数**:
  - `post_id`: 文章 ID (必需)
- **输出数据**:
  - 文章完整信息 (标题、内容、摘要、分类、标签、封面、元数据)
  - Markdown 格式内容
  - 发布信息 (状态、发布时间、更新时间)

#### 2.1.4 文章创建功能
- **功能名称**: `create_post`
- **功能描述**: 创建新的 Halo 博客文章
- **输入参数**:
  - `title`: 文章标题 (必需)
  - `content`: 文章内容 Markdown 格式 (必需)
  - `excerpt`: 文章摘要 (可选)
  - `cover`: 封面图片 URL (可选)
  - `categories`: 分类列表 (可选)
  - `tags`: 标签列表 (可选)
  - `publish_status`: 发布状态 (PUBLISHED/DRAFT，默认 DRAFT)
  - `allow_comment`: 是否允许评论 (可选，默认 true)
  - `pinned`: 是否置顶 (可选，默认 false)
- **输出数据**:
  - 创建的文章信息 (ID, 访问链接, 状态)

#### 2.1.5 文章更新功能
- **功能名称**: `update_post`
- **功能描述**: 更新现有的 Halo 博客文章
- **输入参数**:
  - `post_id`: 文章 ID (必需)
  - `title`: 文章标题 (可选)
  - `content`: 文章内容 Markdown 格式 (可选)
  - `excerpt`: 文章摘要 (可选)
  - `cover`: 封面图片 URL (可选)
  - `categories`: 分类列表 (可选)
  - `tags`: 标签列表 (可选)
  - `publish_status`: 发布状态 (PUBLISHED/DRAFT) (可选)
  - `allow_comment`: 是否允许评论 (可选)
  - `pinned`: 是否置顶 (可选)
- **输出数据**:
  - 更新的文章信息 (ID, 访问链接, 更新时间)

#### 2.1.6 文章删除功能
- **功能名称**: `delete_post`
- **功能描述**: 删除指定的 Halo 博客文章
- **输入参数**:
  - `post_id`: 文章 ID (必需)
- **输出数据**:
  - 操作成功确认信息

#### 2.1.7 瞬间管理功能
- **功能描述**: 提供对 Halo 瞬间的创建、获取、更新和删除功能。

##### 2.1.7.1 创建瞬间
- **功能名称**: `create_moment`
- **输入参数**:
  - `content`: 瞬间文本内容 (可选)
  - `media_urls`: 媒体文件 URL 列表 (可选)
  - `media_type`: 媒体类型 (PHOTO/VIDEO/AUDIO)
  - `tags`: 标签列表 (可选)
  - `visibility`: 可见性设置 (PUBLIC/PRIVATE，默认 PUBLIC)
- **输出数据**:
  - 创建的瞬间信息 (ID, 访问链接, 创建时间)

##### 2.1.7.2 获取瞬间列表
- **功能名称**: `get_moments`
- **输入参数**:
  - `page`: 页码 (可选，默认 1)
  - `size`: 每页数量 (可选，默认 10)
  - `tag`: 标签筛选 (可选)
- **输出数据**:
  - 瞬间列表 (ID, 内容, 媒体, 标签)
  - 分页信息

##### 2.1.7.3 更新瞬间
- **功能名称**: `update_moment`
- **输入参数**:
  - `moment_id`: 瞬间 ID (必需)
  - `content`: 瞬间文本内容 (可选)
  - `media_urls`: 媒体文件 URL 列表 (可选)
  - `tags`: 标签列表 (可选)
  - `visibility`: 可见性设置 (PUBLIC/PRIVATE) (可选)
- **输出数据**:
  - 更新的瞬间信息 (ID, 访问链接, 更新时间)

##### 2.1.7.4 删除瞬间
- **功能名称**: `delete_moment`
- **输入参数**:
  - `moment_id`: 瞬间 ID (必需)
- **输出数据**:
  - 操作成功确认信息

### 2.2 辅助功能

#### 2.2.1 分类管理
- 获取分类列表

#### 2.2.2 标签管理  
- 获取标签列表
- 创建新标签 (如果不存在)

#### 2.2.3 错误处理
- 网络连接错误处理
- API 认证失败处理
- 数据格式验证
- 友好的错误信息提示

## 3. 用户场景

### 3.1 场景一：AI 辅助内容创作
**用户角色**: 内容创作者  
**场景描述**: 用户在 Dify 中使用 AI 生成文章内容，然后直接发布到 Halo 博客

**操作流程**:
1. 在 Dify 工作流中配置 Halo 连接信息
2. 使用 AI 生成文章标题和内容
3. 调用 `create_post` 工具创建文章
4. 设置分类、标签和发布状态
5. 文章成功发布到 Halo 博客

### 3.2 场景二：批量内容管理
**用户角色**: 博客管理员  
**场景描述**: 管理员需要批量更新多篇文章的分类或标签

**操作流程**:
1. 调用 `get_posts` 获取文章列表
2. 根据条件筛选需要更新的文章
3. 批量调用 `update_post` 更新文章属性
4. 确认更新结果

### 3.3 场景三：瞬间内容发布
**用户角色**: 日常用户  
**场景描述**: 用户想要分享日常瞬间，包含图片和文字

**操作流程**:
1. 准备瞬间内容 (文字 + 图片)
2. 调用 `create_moment` 创建瞬间
3. 设置标签和可见性
4. 瞬间成功发布

### 3.4 场景四：内容迁移
**用户角色**: 内容创作者  
**场景描述**: 从其他平台迁移内容到 Halo 博客

**操作流程**:
1. 获取原始平台的文章数据
2. 转换为 Markdown 格式
3. 批量调用 `create_post` 创建文章
4. 设置适当的分类和标签
5. 验证迁移结果

## 4. 非功能需求

### 4.1 性能要求
- API 响应时间不超过 5 秒
- 支持并发操作 (最多 10 个并发请求)
- 大文件上传超时时间 60 秒

### 4.2 安全要求
- 个人访问令牌安全存储
- 支持 HTTPS 连接
- 输入数据验证和清理
- 错误信息不暴露敏感数据

### 4.3 兼容性要求
- 支持 Halo 2.21+ 版本
- 兼容 Dify Plugin Framework
- 支持 UTF-8 字符编码
- 兼容主流操作系统

### 4.4 可维护性要求
- 代码结构清晰，易于维护
- 完善的错误日志记录
- 详细的 API 文档
- 单元测试覆盖率 80%+

## 5. 约束条件

### 5.1 技术约束
- 必须使用 Dify Plugin Framework
- 依赖 Halo REST API
- 需要网络连接支持

### 5.2 业务约束  
- 需要有效的 Halo 个人访问令牌
- 令牌需要适当的权限配置
- 遵循 Halo API 的使用限制

### 5.3 时间约束
- 项目开发周期: 4 周
- 测试验证周期: 1 周
- 文档完善周期: 1 周

## 6. 验收标准

### 6.1 功能验收
- [ ] 所有核心功能正常工作
- [ ] 错误处理机制完善
- [ ] 用户场景全部验证通过

### 6.2 性能验收
- [ ] API 响应时间符合要求
- [ ] 并发处理能力满足需求
- [ ] 内存和 CPU 使用率合理

### 6.3 安全验收
- [ ] 认证机制安全可靠
- [ ] 数据传输加密
- [ ] 输入验证完整

### 6.4 文档验收
- [ ] API 文档完整准确
- [ ] 用户使用手册清晰
- [ ] 示例代码可运行

---

**文档版本**: v1.0.0  
**创建日期**: 2024年12月  
**负责人**: 开发团队  
**审核人**: 产品经理 