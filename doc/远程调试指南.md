# Halo Blog Tools Plugin - 远程调试指南

## 📋 准备工作

### 1. 获取远程调试密钥

1. 访问 [Dify 插件开发者面板](https://dify.ai/plugins/developer)
2. 登录您的Dify账户
3. 找到"远程调试"或"Remote Debugging"部分
4. 复制调试密钥（通常是一个长字符串）

### 2. 配置环境变量

1. 复制 `.env.template` 为 `.env`：
   ```bash
   cp .env.template .env
   ```

2. 编辑 `.env` 文件，填入正确的值：
   ```env
   INSTALL_METHOD=remote
   REMOTE_INSTALL_URL=https://remote-plugin-dev.dify.ai/install
   REMOTE_INSTALL_KEY=你的实际调试密钥
   ```

## 🚀 启动远程调试

### 使用官方CLI工具（推荐）

```bash
# 确保在项目根目录
cd halo-blog-tools

# 启动远程调试
python -m main
```

### 手动启动

```bash
# 激活Python环境（如果使用虚拟环境）
# source venv/bin/activate  # Linux/macOS
# venv\Scripts\activate     # Windows

# 安装依赖
pip install -r requirements.txt

# 启动插件
python main.py
```

## 📊 验证连接

启动后应该看到类似以下日志：

```
2025-07-01 10:15:00,123 - __main__ - INFO - Plugin starting with install method: remote
2025-07-01 10:15:00,124 - __main__ - INFO - Remote URL configured: https://remote-plugin-dev.dify.ai/install
2025-07-01 10:15:00,125 - __main__ - INFO - Remote key configured: ********1234
2025-07-01 10:15:00,200 - __main__ - INFO - Halo Blog Tools plugin initialized successfully
```

## 🔧 在Dify中测试

### 1. 添加插件到Dify

1. 在Dify中创建新的应用或工作流
2. 进入"工具"或"Tools"部分
3. 选择"添加自定义工具"
4. 找到"Halo Blog Tools"插件
5. 配置连接参数：
   - **Halo CMS Base URL**: 您的Halo站点URL
   - **Personal Access Token**: Halo个人访问令牌

### 2. 测试连接

首先使用"Halo Setup"工具测试连接：

```
工具: Halo Setup
参数: （无需参数）
```

成功连接后应该显示：
- ✅ 连接状态
- 📊 站点统计信息
- 🔧 可用功能列表

### 3. 测试功能

**创建文章：**
```
工具: Halo Post Create
参数:
- title: "测试文章标题"
- content: "这是一篇测试文章的内容"
- publish_immediately: true
```

**获取文章列表：**
```
工具: Halo Post List
参数:
- page: 0
- size: 10
```

**创建动态：**
```
工具: Halo Moment Create
参数:
- content: "这是一条测试动态"
- media_urls: []
```

## 🐛 故障排除

### 常见问题

1. **连接失败**
   - 检查网络连接
   - 验证调试密钥是否正确
   - 确认Dify服务状态

2. **认证错误**
   - 检查Halo CMS URL是否正确
   - 验证Personal Access Token权限
   - 确认token未过期

3. **权限不足**
   - 确保token具有以下权限：
     - `post:manage`
     - `moment:manage`
     - `category:view`
     - `tag:view`

### 调试技巧

1. **增加日志级别**：
   ```env
   LOG_LEVEL=DEBUG
   ```

2. **检查网络连接**：
   ```bash
   curl -H "Authorization: Bearer YOUR_TOKEN" \
        https://your-halo-site.com/apis/content.halo.run/v1alpha1/posts?page=0&size=1
   ```

3. **验证插件包**：
   ```bash
   # 检查包文件大小和内容
   ls -la halo-blog-tools.difypkg
   ```

## 📚 相关资源

- [Dify插件开发文档](https://docs.dify.ai/plugin-dev-zh/)
- [Halo CMS API文档](https://docs.halo.run/developer-guide/api)
- [项目GitHub仓库](https://github.com/your-username/halo-blog-tools)

## 💡 提示

- 远程调试会消耗Dify的配额，建议在本地开发完成后再进行远程测试
- 调试密钥有时效性，过期后需要重新获取
- 建议在测试环境中进行调试，避免影响生产数据 