# Halo CMS Dify Plugin è¿œç¨‹è°ƒè¯•æŒ‡å— - v0.0.5

## ğŸ¯ è¿œç¨‹è°ƒè¯•æ¦‚è¿°

è¿œç¨‹è°ƒè¯•å…è®¸æˆ‘ä»¬åœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒä¸­è¿è¡Œæ’ä»¶ï¼ŒåŒæ—¶è¿æ¥åˆ° cloud.dify.ai è¿›è¡Œå®æ—¶æµ‹è¯•å’Œè°ƒè¯•ã€‚

## ğŸ”§ ç¯å¢ƒé…ç½®

### 1. å®‰è£…ä¾èµ–
```bash
pip install -r requirements.txt
```

### 2. é…ç½®è¿œç¨‹è°ƒè¯•å¯†é’¥
åˆ›å»º `key.txt` æ–‡ä»¶ï¼ˆä¸è¦æäº¤åˆ°Gitï¼‰ï¼š
```
your-remote-debug-key-here
```

### 3. ç¯å¢ƒå˜é‡é…ç½®
åˆ›å»º `.env` æ–‡ä»¶ï¼ˆä¸è¦æäº¤åˆ°Gitï¼‰ï¼š
```env
DIFY_REMOTE_DEBUG_KEY=your-remote-debug-key-here
HALO_BASE_URL=https://your-halo-site.com
HALO_ACCESS_TOKEN=your-access-token
```

## ğŸš€ å¯åŠ¨è¿œç¨‹è°ƒè¯•

### æ–¹æ³•1ï¼šç›´æ¥å¯åŠ¨
```bash
python -m main
```

### æ–¹æ³•2ï¼šä½¿ç”¨è°ƒè¯•è„šæœ¬
```bash
python start_remote_debug.py
```

### æ–¹æ³•3ï¼šä½¿ç”¨è¿œç¨‹è°ƒè¯•æ¨¡å—
```bash
python remote_debug.py
```

## ğŸ“Š è°ƒè¯•æµç¨‹

### 1. å¯åŠ¨è°ƒè¯•æœåŠ¡
```
2025-07-01 16:42:56,075 - __main__ - INFO - Starting Halo Blog Tools plugin...
2025-07-01 16:42:56,076 - __main__ - INFO - Plugin starting with install method: remote
2025-07-01 16:42:56,077 - __main__ - INFO - Remote key configured: ****************************dee8449f
2025-07-01 16:42:56,915 - dify_plugin.core.server.tcp.request_reader - INFO - Connected to debug.dify.ai:5003
2025-07-01 16:42:56,928 - dify_plugin.plugin - INFO - Installed tool: halo-blog-tools
2025-07-01 16:42:56,929 - dify_plugin.core.server.tcp.request_reader - INFO - Sent key to debug.dify.ai:5003
2025-07-01 16:42:56,932 - __main__ - INFO - Halo Blog Tools plugin initialized successfully
```

### 2. åœ¨ cloud.dify.ai ä¸­æµ‹è¯•
- æ‰“å¼€ cloud.dify.ai
- è¿›å…¥åº”ç”¨è®¾ç½®
- æ·»åŠ è‡ªå®šä¹‰æ’ä»¶
- ä½¿ç”¨è¿œç¨‹è°ƒè¯•å¯†é’¥è¿æ¥

### 3. å®æ—¶æŸ¥çœ‹æ—¥å¿—
æœ¬åœ°ç»ˆç«¯ä¼šæ˜¾ç¤ºæ‰€æœ‰APIè°ƒç”¨å’Œå“åº”ï¼š
```
2025-07-01 16:45:27,156 - tools.halo-post-create - INFO - Trying endpoint /apis/api.console.halo.run/v1alpha1/users/-: status 200
2025-07-01 16:45:27,215 - tools.halo-post-create - INFO - Create post response status: 201
2025-07-01 16:45:27,215 - tools.halo-post-create - INFO - Create post response body: {"spec":{"title":"æµ‹è¯•15"...
```

## ğŸ” è°ƒè¯•æŠ€å·§

### 1. è¯¦ç»†æ—¥å¿—è®°å½•
```python
import logging
logger = logging.getLogger(__name__)

# è®°å½•è¯·æ±‚æ•°æ®
logger.info(f"Creating post with data: {json.dumps(post_data, indent=2, ensure_ascii=False)}")

# è®°å½•å“åº”ä¿¡æ¯
logger.info(f"Response status: {response.status_code}")
logger.info(f"Response headers: {dict(response.headers)}")
logger.info(f"Response body: {response.text}")
```

### 2. é”™è¯¯å¤„ç†å’Œè°ƒè¯•
```python
try:
    response = session.post(url, json=data, timeout=30)
    logger.info(f"Request successful: {response.status_code}")
except requests.exceptions.RequestException as e:
    logger.error(f"Request failed: {str(e)}")
    yield self.create_text_message(f"âŒ è¯·æ±‚å¤±è´¥: {str(e)}")
    return
```

### 3. åˆ†æ­¥è°ƒè¯•
```python
# æ­¥éª¤1ï¼šæµ‹è¯•è¿æ¥
yield self.create_text_message("ğŸ”— æ­£åœ¨æµ‹è¯•è¿æ¥...")

# æ­¥éª¤2ï¼šéªŒè¯æƒé™
yield self.create_text_message("ğŸ” æ­£åœ¨éªŒè¯æƒé™...")

# æ­¥éª¤3ï¼šæ‰§è¡Œæ“ä½œ
yield self.create_text_message("ğŸ“ æ­£åœ¨åˆ›å»ºæ–‡ç« ...")
```

## ğŸ› å¸¸è§é—®é¢˜

### 1. è¿æ¥å¤±è´¥
**é—®é¢˜**ï¼šæ— æ³•è¿æ¥åˆ° debug.dify.ai
**è§£å†³**ï¼š
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- éªŒè¯è°ƒè¯•å¯†é’¥æ˜¯å¦æ­£ç¡®
- ç¡®è®¤é˜²ç«å¢™è®¾ç½®

### 2. æƒé™é”™è¯¯
**é—®é¢˜**ï¼š403 Forbidden é”™è¯¯
**è§£å†³**ï¼š
- æ£€æŸ¥ Halo è®¿é—®ä»¤ç‰Œ
- éªŒè¯ä»¤ç‰Œæƒé™èŒƒå›´
- ç¡®è®¤ Halo ç‰ˆæœ¬å…¼å®¹æ€§

### 3. è¶…æ—¶é—®é¢˜
**é—®é¢˜**ï¼šè¯·æ±‚è¶…æ—¶
**è§£å†³**ï¼š
```python
# å¢åŠ è¶…æ—¶æ—¶é—´
response = session.get(url, timeout=60)

# æ·»åŠ é‡è¯•æœºåˆ¶
for attempt in range(3):
    try:
        response = session.get(url, timeout=30)
        break
    except requests.exceptions.Timeout:
        if attempt == 2:
            raise
        time.sleep(1)
```

## ğŸ“ˆ æ€§èƒ½ç›‘æ§

### 1. è¯·æ±‚æ—¶é—´ç›‘æ§
```python
import time

start_time = time.time()
response = session.post(url, json=data)
end_time = time.time()

logger.info(f"Request took {end_time - start_time:.2f} seconds")
```

### 2. å†…å­˜ä½¿ç”¨ç›‘æ§
```python
import psutil
import os

process = psutil.Process(os.getpid())
memory_info = process.memory_info()
logger.info(f"Memory usage: {memory_info.rss / 1024 / 1024:.2f} MB")
```

## ğŸ”„ ç‰ˆæœ¬æ›´æ–°æµç¨‹

### 1. ä¿®æ”¹ä»£ç 
- ä¿®å¤bugæˆ–æ·»åŠ åŠŸèƒ½
- æ›´æ–°ç‰ˆæœ¬å·

### 2. é‡å¯è°ƒè¯•æœåŠ¡
```bash
# åœæ­¢å½“å‰æœåŠ¡ (Ctrl+C)
# é‡æ–°å¯åŠ¨
python -m main
```

### 3. åœ¨ cloud.dify.ai ä¸­æµ‹è¯•
- æ–°åŠŸèƒ½ä¼šè‡ªåŠ¨ç”Ÿæ•ˆ
- æ— éœ€é‡æ–°é…ç½®æ’ä»¶

## ğŸ“ è°ƒè¯•æ—¥å¿—åˆ†æ

### æˆåŠŸçš„è¯·æ±‚æ—¥å¿—
```
INFO - Trying endpoint /apis/api.console.halo.run/v1alpha1/users/-: status 200
INFO - Successfully got username: jason
INFO - Create post response status: 201
INFO - Parsed response successfully, post_name: 489e4f0a-ba15-4c80-b341-c81918cecca2
```

### å¤±è´¥çš„è¯·æ±‚æ—¥å¿—
```
WARNING - å†…å®¹æ›´æ–°å‡ºé”™: cannot access local variable 'datetime' where it is not associated with a value
ERROR - Request failed: HTTPSConnectionPool(host='blog.u2u.fun', port=443)
```

## ğŸ¯ æœ€ä½³å®è·µ

1. **ä¿æŒæ—¥å¿—è¯¦ç»†ä½†ä¸å†—ä½™**
2. **ä½¿ç”¨æœ‰æ„ä¹‰çš„é”™è¯¯æ¶ˆæ¯**
3. **åŠæ—¶æ¸…ç†è°ƒè¯•ä»£ç **
4. **å®šæœŸå¤‡ä»½è°ƒè¯•é…ç½®**
5. **è®°å½•é‡è¦çš„è°ƒè¯•å‘ç°**
