# Halo CMS Dify Plugin 使用指南 - v0.0.5

## 🚀 快速开始

### 1. 前置要求
- Halo CMS 2.21+ 版本
- 有效的个人访问令牌
- Dify 平台账号

### 2. 获取访问令牌
1. 登录 Halo CMS 后台
2. 进入 `用户` -> `个人资料` -> `个人令牌`
3. 点击 `新建令牌`
4. 设置令牌名称和过期时间
5. 选择以下权限：
   - `post:manage` - 文章管理
   - `moment:manage` - 动态管理
   - `category:manage` - 分类管理
   - `tag:manage` - 标签管理

### 3. 安装插件
1. 在 Dify 中进入应用设置
2. 选择 `插件` -> `添加插件`
3. 选择 `自定义插件`
4. 输入插件信息或GitHub地址
5. 配置连接参数

## 🔧 配置说明

### 基础配置
```yaml
base_url: "https://your-halo-site.com"
access_token: "pat_xxxxxxxxxxxxxxxxxx"
```

### 配置验证
使用 `halo-setup` 工具验证配置：
```
✅ Halo CMS 连接成功
✅ 用户认证成功: jason
✅ 权限验证通过
```

## 📝 工具使用指南

### 1. halo-setup - 连接测试
**功能**：测试 Halo CMS 连接和权限
**参数**：无
**示例**：
```
工具：halo-setup
结果：✅ 连接测试成功，用户：jason，权限正常
```

### 2. halo-post-create - 创建文章
**功能**：创建新文章
**参数**：
- `title` (必需): 文章标题
- `content` (必需): 文章内容
- `editor_type` (可选): 编辑器类型 (default/markdown/richtext/bytemd)
- `publish_immediately` (可选): 是否立即发布 (true/false)

**示例**：
```
工具：halo-post-create
参数：
- title: "我的第一篇文章"
- content: "这是文章内容..."
- editor_type: "default"
- publish_immediately: true

结果：✅ 文章创建成功！文章ID: abc123
```

### 3. halo-post-update - 更新文章
**功能**：更新现有文章
**参数**：
- `post_id` (必需): 文章ID
- `title` (可选): 新标题
- `content` (可选): 新内容
- `editor_type` (可选): 编辑器类型
- `published` (可选): 发布状态 (true/false)

**示例**：
```
工具：halo-post-update
参数：
- post_id: "abc123"
- title: "更新后的标题"
- content: "更新后的内容..."
- published: true

结果：✅ 文章更新成功！
```

### 4. halo-post-get - 获取文章
**功能**：获取文章详细信息
**参数**：
- `post_id` (必需): 文章ID

**示例**：
```
工具：halo-post-get
参数：
- post_id: "abc123"

结果：
标题：我的第一篇文章
状态：已发布
创建时间：2025-07-01T10:00:00Z
内容：这是文章内容...
```

### 5. halo-post-list - 文章列表
**功能**：获取文章列表
**参数**：
- `page` (可选): 页码，默认1
- `size` (可选): 每页数量，默认10

**示例**：
```
工具：halo-post-list
参数：
- page: 1
- size: 5

结果：
找到 3 篇文章：
1. 我的第一篇文章 (已发布)
2. 测试文章 (草稿)
3. 技术分享 (已发布)
```

### 6. halo-post-delete - 删除文章
**功能**：删除文章
**参数**：
- `post_id` (必需): 文章ID

**示例**：
```
工具：halo-post-delete
参数：
- post_id: "abc123"

结果：✅ 文章删除成功！
```

### 7. halo-moment-create - 创建动态
**功能**：创建新动态
**参数**：
- `content` (必需): 动态内容
- `tags` (可选): 标签列表，用逗号分隔

**示例**：
```
工具：halo-moment-create
参数：
- content: "今天天气不错！"
- tags: "生活,随想"

结果：✅ 动态发布成功！
```

### 8. halo-moment-list - 动态列表
**功能**：获取动态列表
**参数**：
- `page` (可选): 页码，默认1
- `size` (可选): 每页数量，默认10

### 9. halo-categories-list - 分类列表
**功能**：获取文章分类列表
**参数**：无

### 10. halo-tags-list - 标签列表
**功能**：获取文章标签列表
**参数**：无

## 🎯 使用场景

### 场景1：AI写作助手
```
用户：帮我写一篇关于AI技术的文章
AI：我来为您创建一篇AI技术文章...

[使用 halo-post-create 创建文章]
✅ 文章《AI技术的发展趋势》创建成功并已发布！
```

### 场景2：内容管理
```
用户：查看我最近的文章
AI：让我为您查看最近的文章...

[使用 halo-post-list 获取列表]
您最近的文章：
1. AI技术的发展趋势 (已发布)
2. 编程学习心得 (草稿)
```

### 场景3：快速发布动态
```
用户：发布一条关于今天学习的动态
AI：我来为您发布学习动态...

[使用 halo-moment-create 创建动态]
✅ 动态发布成功！内容：今天学习了新的编程技巧
```

## ⚠️ 注意事项

### 权限要求
- 确保访问令牌具有足够权限
- 定期检查令牌有效期
- 避免在公共场所暴露令牌

### 内容格式
- 支持 Markdown 格式
- 富文本内容会自动转换
- 特殊字符需要正确转义

### 性能考虑
- 大量操作时注意API限制
- 避免频繁的列表查询
- 合理设置分页参数

### 错误处理
- 网络异常时会自动重试
- 权限错误会给出明确提示
- 参数错误会显示具体原因

## 🔧 故障排除

### 连接失败
1. 检查 Halo CMS 地址是否正确
2. 确认网络连接正常
3. 验证访问令牌有效性

### 权限错误
1. 检查令牌权限范围
2. 确认用户角色权限
3. 联系管理员分配权限

### 内容显示异常
1. 检查编辑器类型设置
2. 验证内容格式正确性
3. 尝试不同的编辑器类型

## 📞 技术支持

如遇到问题，请提供以下信息：
- Halo CMS 版本
- 错误信息截图
- 操作步骤描述
- 插件版本号
