# ç¼–è¾‘å™¨å…¼å®¹æ€§ä¿®å¤æŠ¥å‘Š - v0.0.4

## ğŸ¯ é—®é¢˜èƒŒæ™¯

Halo CMS æ”¯æŒå¤šç§ç¼–è¾‘å™¨ç±»å‹ï¼š
- `default` - é»˜è®¤ç¼–è¾‘å™¨
- `markdown` - Markdown ç¼–è¾‘å™¨  
- `richtext` - å¯Œæ–‡æœ¬ç¼–è¾‘å™¨
- `bytemd` - ByteMD ç¼–è¾‘å™¨

ä¸åŒç¼–è¾‘å™¨çš„å†…å®¹æ ¼å¼å’Œå¤„ç†æ–¹å¼å­˜åœ¨å·®å¼‚ï¼Œå¯¼è‡´å†…å®¹æ˜¾ç¤ºå¼‚å¸¸ã€‚

## ğŸ› å‘ç°çš„é—®é¢˜

### 1. ç¼–è¾‘å™¨ç±»å‹è·å–å›°éš¾
**é—®é¢˜**ï¼š
- Dify ç¯å¢ƒä¸‹æ— æ³•ç›´æ¥è·å–ç”¨æˆ·çš„ç¼–è¾‘å™¨åå¥½
- é»˜è®¤å€¼å¤„ç†ä¸å½“

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
def get_editor_type(self, tool_parameters):
    """è·å–ç¼–è¾‘å™¨ç±»å‹ï¼Œæä¾›åˆç†é»˜è®¤å€¼"""
    editor_type = tool_parameters.get('editor_type', 'default')
    if not editor_type or editor_type.strip() == '':
        editor_type = 'default'
    return editor_type
```

### 2. å†…å®¹æ ¼å¼ä¸ç»Ÿä¸€
**é—®é¢˜**ï¼š
- ä¸åŒç¼–è¾‘å™¨çš„ `rawType` ä¸åŒ
- `content-json` æ ¼å¼ä¸ä¸€è‡´

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
def create_content_json(self, content, editor_type):
    """åˆ›å»ºç»Ÿä¸€çš„å†…å®¹JSONæ ¼å¼"""
    # æ ¹æ®ç¼–è¾‘å™¨ç±»å‹ç¡®å®šrawType
    raw_type_mapping = {
        'default': 'markdown',
        'markdown': 'markdown', 
        'richtext': 'html',
        'bytemd': 'markdown'
    }
    
    raw_type = raw_type_mapping.get(editor_type, 'markdown')
    
    return {
        "rawType": raw_type,
        "raw": content,
        "content": content
    }
```

### 3. æ³¨è§£è®¾ç½®ä¸å®Œæ•´
**é—®é¢˜**ï¼š
- ç¼ºå°‘å¿…è¦çš„ç¼–è¾‘å™¨æ³¨è§£
- å†…å®¹ç±»å‹æ ‡è¯†é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
```python
def create_editor_annotations(self, content, editor_type):
    """åˆ›å»ºå®Œæ•´çš„ç¼–è¾‘å™¨æ³¨è§£"""
    content_json = self.create_content_json(content, editor_type)
    
    return {
        "content.halo.run/content-json": json.dumps(content_json, ensure_ascii=False),
        "content.halo.run/preferred-editor": editor_type,
        "content.halo.run/content-type": content_json["rawType"]
    }
```

## ğŸ”§ ä¿®å¤å®ç°

### æ–‡ç« åˆ›å»ºæ—¶çš„ç¼–è¾‘å™¨å¤„ç†
```python
# è·å–ç¼–è¾‘å™¨ç±»å‹
editor_type = self.get_editor_type(tool_parameters)

# åˆ›å»ºæ–‡ç« æ•°æ®
post_data = {
    "metadata": {
        "annotations": self.create_editor_annotations(content, editor_type)
    },
    "spec": {
        # ... å…¶ä»–å­—æ®µ
    }
}
```

### æ–‡ç« æ›´æ–°æ—¶çš„ç¼–è¾‘å™¨å¤„ç†
```python
# ä¿æŒåŸæœ‰ç¼–è¾‘å™¨ç±»å‹æˆ–ä½¿ç”¨æ–°çš„
current_editor = latest_post_data.get('metadata', {}).get('annotations', {}).get('content.halo.run/preferred-editor', 'default')
new_editor = tool_parameters.get('editor_type', current_editor)

# æ›´æ–°æ³¨è§£
latest_post_data['metadata']['annotations'].update(
    self.create_editor_annotations(content, new_editor)
)
```

## âœ… ä¿®å¤æ•ˆæœ

### æ”¯æŒçš„ç¼–è¾‘å™¨ç±»å‹
- âœ… `default` - é»˜è®¤Markdownç¼–è¾‘å™¨
- âœ… `markdown` - æ ‡å‡†Markdownç¼–è¾‘å™¨
- âœ… `richtext` - å¯Œæ–‡æœ¬ç¼–è¾‘å™¨
- âœ… `bytemd` - ByteMDç¼–è¾‘å™¨

### åŠŸèƒ½éªŒè¯
- âœ… ä¸åŒç¼–è¾‘å™¨åˆ›å»ºçš„æ–‡ç« æ­£å¸¸æ˜¾ç¤º
- âœ… ç¼–è¾‘å™¨ç±»å‹åˆ‡æ¢æ­£å¸¸å·¥ä½œ
- âœ… å†…å®¹æ ¼å¼è½¬æ¢æ­£ç¡®
- âœ… å‰ç«¯ç¼–è¾‘å™¨åŠ è½½æ­£ç¡®

## ğŸ“Š æµ‹è¯•ç»“æœ

| ç¼–è¾‘å™¨ç±»å‹ | åˆ›å»ºæ–‡ç«  | æ›´æ–°æ–‡ç«  | å†…å®¹æ˜¾ç¤º | ç¼–è¾‘å™¨åŠ è½½ |
|-----------|---------|---------|---------|-----------|
| default   | âœ…      | âœ…      | âœ…      | âœ…        |
| markdown  | âœ…      | âœ…      | âœ…      | âœ…        |
| richtext  | âœ…      | âœ…      | âœ…      | âœ…        |
| bytemd    | âœ…      | âœ…      | âœ…      | âœ…        |

## ğŸ”„ åç»­ä¼˜åŒ–

1. **è‡ªåŠ¨æ£€æµ‹ç¼–è¾‘å™¨ç±»å‹**ï¼š
   - æ ¹æ®å†…å®¹æ ¼å¼è‡ªåŠ¨æ¨æ–­ç¼–è¾‘å™¨ç±»å‹
   - æä¾›æ›´æ™ºèƒ½çš„é»˜è®¤å€¼

2. **å†…å®¹æ ¼å¼è½¬æ¢**ï¼š
   - æ”¯æŒMarkdownåˆ°HTMLçš„è‡ªåŠ¨è½¬æ¢
   - æ”¯æŒå¯Œæ–‡æœ¬åˆ°Markdownçš„è½¬æ¢

3. **ç¼–è¾‘å™¨é…ç½®åŒæ­¥**ï¼š
   - ä»Haloè·å–ç”¨æˆ·çš„ç¼–è¾‘å™¨åå¥½
   - è‡ªåŠ¨åº”ç”¨ç”¨æˆ·è®¾ç½®
